{"version":3,"file":"index.js","mappings":"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","sources":["webpack://axolotis-player/webpack/universalModuleDefinition","webpack://axolotis-player/webpack/bootstrap","webpack://axolotis-player/webpack/runtime/define property getters","webpack://axolotis-player/webpack/runtime/hasOwnProperty shorthand","webpack://axolotis-player/webpack/runtime/make namespace object","webpack://axolotis-player/./src/lib/modules/core/ecs/Entity.ts","webpack://axolotis-player/./src/lib/modules/core/ecs/WorldEntity.ts","webpack://axolotis-player/./src/lib/modules/core/loader/Global.ts","webpack://axolotis-player/./src/lib/modules/core/loader/LocalLoader.ts","webpack://axolotis-player/./src/lib/modules/core/loader/JsLoader.ts","webpack://axolotis-player/./src/lib/modules/core/loader/InitialComponentLoader.ts","webpack://axolotis-player/./src/lib/modules/core/loader/CodeLoader.ts","webpack://axolotis-player/./src/lib/modules/core/loader/service/LazyServices.ts","webpack://axolotis-player/./src/lib/modules/core/loader/service/Services.ts","webpack://axolotis-player/./src/lib/modules/core/loader/BasicInit.ts","webpack://axolotis-player/./src/lib/modules/core/loader/DomInit.ts","webpack://axolotis-player/./src/lib/modules/core/loader/service/ServiceUtils.ts","webpack://axolotis-player/./src/lib/modules/core/loader/entity/LazyEntity.ts","webpack://axolotis-player/./src/lib/modules/core/loader/Item.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"axolotis-player\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"axolotis-player\"] = factory();\n\telse\n\t\troot[\"axolotis-player\"] = factory();\n})(this, function() {\nreturn ","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { Component } from \"./Component\";\n\nexport class Entity implements Component {\n  private components: Component[] = [];\n\n  constructor() {}\n\n  public addComponent<T extends Component>(component: T): T {\n    if (component.init) {\n      component.init();\n    }\n    this.components.push(component);\n    return component;\n  }\n\n  public removeAllComponents() {\n    this.components.forEach((comp) => {\n      this.removeComponent(comp);\n    });\n  }\n\n  public removeComponent<T extends Component>(component: T): T {\n    if (component.destroy) {\n      component.destroy();\n    }\n    this.components = this.components.filter((comp) => {\n      return comp != component;\n    });\n    return component;\n  }\n\n  public addComponents(components: Component[]) {\n    components.forEach((comp) => {\n      this.addComponent(comp);\n    });\n  }\n\n  public getComponents(): Component[] {\n    return this.components;\n  }\n\n  public getComponentByType<T extends Component>(type: string): T[] {\n    let ret: T[] = [];\n    this.components.forEach((comp) => {\n      if (comp.getType() === type) {\n        ret.push(comp as T);\n      }\n    });\n    return ret;\n  }\n\n  public getComponentByTypeStartsWith(type: string): Component[] {\n    let ret: Component[] = [];\n    this.components.forEach((comp) => {\n      if (comp.getType().startsWith(type)) {\n        ret.push(comp);\n      }\n    });\n    return ret;\n  }\n\n  public getFirstComponentByTypeStartsWith<T extends Component>(type: string): T {\n    return this.getComponentByTypeStartsWith(type)[0] as T;\n  }\n\n  public getFirstComponentByType<T extends Component>(type: string): T {\n    return this.getComponentByType(type)[0] as T;\n  }\n\n  public getType(): string {\n    return Entity.name;\n  }\n}\n\nexport default Entity;\n","import Entity from \"@root/lib/modules/core/ecs/Entity\";\n\nexport class WorldEntity extends Entity {\n  constructor() {\n    super();\n  }\n  public getType(): string {\n    return WorldEntity.name;\n  }\n}\n","var axolotis = null;\n\nexport const GLOBAL_WORLDS_ENTITY = \"worlds\";\nexport const GLOBAL_STATIC_SERVICES = \"staticServices\";\nexport const GLOBAL_LOCAL_MODULE = \"localModules\";\n\nexport function getGlobalStorage(): any {\n  //not axolotis in window => create it\n  if (typeof window !== \"undefined\") {\n    if (!(window as any).axolotis) {\n      (window as any).axolotis = {};\n    }\n  }\n\n  //axolotis var not initialized with window\n  if (!axolotis && typeof window !== \"undefined\") {\n    axolotis = (window as any).axolotis;\n  }\n\n  if (!axolotis) {\n    axolotis = {};\n  }\n\n  return axolotis;\n}\n\nexport function setGlobalStorageValue(key, value) {\n  let globalStorage = getGlobalStorage();\n  globalStorage[key] = value;\n}\n\nexport function getGlobalStorageValue<T>(key, auto: boolean = true): T {\n  let globalStorage = getGlobalStorage();\n  if (!globalStorage[key] && auto) {\n    globalStorage[key] = {};\n  }\n  return globalStorage[key] as T;\n}\n","import { getGlobalStorageValue } from \"@root/lib/modules/core/loader/Global\";\nimport Component from \"../ecs/Component\";\nimport { WorldEntity } from \"../ecs/WorldEntity\";\nimport { Services } from \"./service/Services\";\nimport { GLOBAL_LOCAL_MODULE } from \"@root/lib\";\n\nexport type Module = () => Promise<{ module: any; classname: string }>;\nexport interface LocalModules {\n  [id: string]: Module;\n}\n\nexport function registerLocalModule(name: string, module: Module, moduleStorage?: LocalModules) {\n  if (!moduleStorage) {\n    moduleStorage = getGlobalStorageValue<LocalModules>(GLOBAL_LOCAL_MODULE);\n  }\n  if (moduleStorage[name]) {\n    throw new Error(\"Module already defined\");\n  }\n  moduleStorage[name] = module;\n}\n\nexport function registerLocalModuleList(localModulesList: LocalModules, verbose: boolean = false, moduleStorage?: LocalModules) {\n  if (!moduleStorage) {\n    moduleStorage = getGlobalStorageValue<LocalModules>(GLOBAL_LOCAL_MODULE);\n  }\n  if (verbose) {\n    console.log(\"imported module :\", localModulesList);\n  }\n  Object.assign(moduleStorage, localModulesList);\n}\n\nexport async function instantiateLocalAsyncModule<T>(fqcn: string, localModules: LocalModules, world: WorldEntity, config?: any): Promise<T> {\n  const localModule = await localModules[fqcn]();\n  const module = localModule.module;\n  for (const key in module) {\n    const sub = module[key];\n    if (sub.prototype && sub.prototype.constructor.name === localModule.classname) {\n      let DependencyComponentList: Component[] = [];\n      if (sub.dependencies) {\n        for (let i = 0; i < sub.dependencies.length; i++) {\n          const dep = sub.dependencies[i];\n          let services = world.getFirstComponentByType<Services>(Services.name);\n          let service = await services.getService<Component>(dep);\n          DependencyComponentList.push(service);\n        }\n      }\n      if (config != undefined) {\n        return new sub(...DependencyComponentList, config);\n      } else {\n        return new sub(...DependencyComponentList);\n      }\n    }\n  }\n  throw new Error(\"invalid submodule \" + fqcn + \" - \" + localModule.classname);\n}\n","import { ComponentFactory } from \"@root/lib/modules/core/ecs/ComponentFactory\";\nimport Component from \"@root/lib/modules/core/ecs/Component\";\nimport { instantiateLocalAsyncModule, LocalModules } from \"@root/lib/modules/core/loader/LocalLoader\";\nimport { WorldEntity } from \"../ecs/WorldEntity\";\n\nexport async function instantiateAsyncModule<T>(moduleName: string, moduleStorage: LocalModules, world?: WorldEntity, config?: any): Promise<T> {\n  let module = null;\n  if (moduleStorage && moduleStorage[moduleName]) {\n    module = await instantiateLocalAsyncModule<Component>(moduleName, moduleStorage, world, config);\n  } else if (moduleName.startsWith(\"http\")) {\n    //TODO remote module \"https://\"\n    throw new Error(\"remote modules not implemented yet\");\n  } else {\n    console.log(\"local module installed:\", moduleStorage);\n    throw new Error(\"unknown module - please register it - \" + moduleName);\n  }\n  return module;\n}\n","import Component from \"@root/lib/modules/core/ecs/Component\";\nimport { load } from \"@root/lib/modules/core/loader/CodeLoader\";\nimport { WorldEntity } from \"@root/lib/modules/core/ecs/WorldEntity\";\nimport { instantiateAsyncModule } from \"@root/lib/modules/core/loader/JsLoader\";\nimport { WorldDefinition } from \"@root/lib/modules/core/loader/WorldDefinition\";\nimport { LocalModules } from \"@root/lib/modules/core/loader/LocalLoader\";\n\nexport const CODE_LOADER_MODULE_NAME = \"@aptero/axolotis-player/core/loader/InitialComponentLoader\";\n\nexport class InitialComponentLoader implements Component {\n  private initialLoading: Promise<any>;\n  private initialLoadingResolver: ((value: any) => void) | undefined;\n  private moduleStorage: LocalModules;\n\n  constructor() {\n    this.initialLoading = new Promise<any>((resolve) => {\n      this.initialLoadingResolver = resolve;\n    });\n  }\n\n  getType(): string {\n    return InitialComponentLoader.name;\n  }\n\n  getModuleStorage() {\n    return this.moduleStorage;\n  }\n\n  async awaitInitialLoading() {\n    await this.initialLoading;\n  }\n\n  async startLoading(world: WorldEntity, scene: WorldDefinition, loadedCallBack: (progress: number, total: number) => void, moduleStorage: LocalModules) {\n    this.moduleStorage = moduleStorage;\n    if (scene.version !== \"2.0\") {\n      throw new Error(\"unsupported\");\n    }\n    let promises: (() => Promise<any>)[] = [];\n    for (const entity of scene.entities) {\n      for (const componentDef of entity.components) {\n        let config = componentDef.config;\n        promises.push(\n          () =>\n            new Promise(async (resolve, reject) => {\n              let module = await instantiateAsyncModule<any>(componentDef.module, moduleStorage, world, config || {}); //module.createComponent(world, config || {});\n              let component = module.getType ? module : ((await module.createComponent(world, config || {})) as Component);\n              if (!component.getType) {\n                throw new Error(\"Not a component : \" + componentDef.module + \" \" + component.constructor.name);\n              }\n              world.addComponent(component); //TODO world default but should ad to an entity\n              resolve(module);\n            })\n        );\n      }\n    }\n\n    let promise = load(promises, loadedCallBack);\n    promise.then((value) => {\n      if (this.initialLoadingResolver !== undefined) {\n        this.initialLoadingResolver(value);\n      }\n    });\n    promise.catch((reason) => {\n      console.error(reason);\n    });\n    return promise;\n  }\n}\n","export function load(modules: (() => Promise<any>)[], loadedCallBack: (progress: number, total: number) => void) {\n  let ret: any[] = [];\n  let nbLoaded = 0;\n  for (const promiseCb of modules) {\n    const promise = promiseCb(); //trigger the load\n    ret.push(promise);\n    promise.then(() => {\n      nbLoaded++;\n      loadedCallBack(nbLoaded, modules.length);\n    });\n  }\n  return Promise.all(ret);\n}\n","import Component from \"@root/lib/modules/core/ecs/Component\";\nimport { instantiateAsyncModule } from \"@root/lib/modules/core/loader/JsLoader\";\nimport { WorldEntity } from \"@root/lib\";\nimport { InitialComponentLoader, CODE_LOADER_MODULE_NAME } from \"@root/lib/modules/core/loader/InitialComponentLoader\";\nimport { IService } from \"@root/lib/modules/core/loader/service/IService\";\n\nexport class LazyServices {\n  constructor(private world: WorldEntity) {}\n\n  serviceAsync: { [id: string]: Promise<IService> | undefined } = {};\n  service: { [id: string]: IService } = {};\n\n  getWorld(): WorldEntity {\n    return this.world;\n  }\n\n  setService(moduleName: string, service: IService, replace = false) {\n    if (!replace && (this.serviceAsync[moduleName] || this.service[moduleName])) {\n      throw new Error(\"Service already exist (use replace to force)\");\n    }\n    this.serviceAsync[moduleName] = Promise.resolve(service);\n    this.service[moduleName] = service;\n    if (service.init) {\n      service.init(); //service init\n    }\n  }\n\n  async getService<T extends IService>(moduleName: string): Promise<T> {\n    if (this.serviceAsync[moduleName]) {\n      //service already downloading add this request to queue;\n      const service = await this.serviceAsync[moduleName];\n      if (!service) {\n        throw new Error(\"error\");\n      }\n      return service as T;\n    }\n    if (!this.serviceAsync[moduleName]) {\n      let modulesList = ((await this.serviceAsync[CODE_LOADER_MODULE_NAME]) as InitialComponentLoader).getModuleStorage();\n      let modulePromise = instantiateAsyncModule<T>(moduleName, modulesList, this.world);\n      this.serviceAsync[moduleName] = new Promise(async (resolve) => {\n        let module: any = await modulePromise;\n        let service: Component = module.getType ? module : await module.createService(this);\n        this.service[moduleName] = service; //module resolved\n        if (service.init) {\n          service.init(); //service init\n        }\n        resolve(service);\n      });\n    }\n    return (await this.serviceAsync[moduleName]) as T;\n  }\n}\n","import Component from \"@root/lib/modules/core/ecs/Component\";\nimport { LazyServices } from \"@root/lib/modules/core/loader/service/LazyServices\";\nimport { IService, IServices } from \"@root/lib\";\n\nexport class Services extends LazyServices implements Component, IServices {\n  getType(): string {\n    return Services.name;\n  }\n\n  getServiceSync<T extends IService>(moduleName: string): T {\n    if (this.service[moduleName]) {\n      return this.service[moduleName] as T;\n    } else {\n      throw new Error(\"service not found\");\n    }\n  }\n}\n","import { Services } from \"@root/lib/modules/core/loader/service/Services\";\nimport { InitialComponentLoader, CODE_LOADER_MODULE_NAME } from \"@root/lib/modules/core/loader/InitialComponentLoader\";\nimport {\n  getGlobalStorage,\n  getGlobalStorageValue,\n  GLOBAL_LOCAL_MODULE,\n  GLOBAL_STATIC_SERVICES,\n  GLOBAL_WORLDS_ENTITY,\n  setGlobalStorageValue,\n} from \"@root/lib/modules/core/loader/Global\";\nimport { LocalModules } from \"@root/lib/modules/core/loader/LocalLoader\";\nimport { WorldDefinition } from \"@root/lib/modules/core/loader/WorldDefinition\";\nimport { IService, WorldEntity } from \"@root/lib\";\n\nexport function createWorldSync(\n  initialScene: WorldDefinition = {\n    version: \"2.0\",\n    entities: [],\n  },\n  loadedCallBack: (progress: number, total: number) => void = () => {},\n  finished: (world: WorldEntity) => void = () => {},\n  moduleStorage?: LocalModules,\n  world?: WorldEntity\n) {\n  if (!world) {\n    world = new WorldEntity();\n  }\n  if (!getGlobalStorageValue(GLOBAL_WORLDS_ENTITY, false)) {\n    setGlobalStorageValue(GLOBAL_WORLDS_ENTITY, [world]);\n  } else {\n    getGlobalStorageValue<WorldEntity[]>(GLOBAL_WORLDS_ENTITY).push(world);\n  }\n  if (!moduleStorage) {\n    moduleStorage = getGlobalStorageValue<LocalModules>(GLOBAL_LOCAL_MODULE);\n  }\n  let serviceEntity = new Services(world);\n  world.addComponent(serviceEntity);\n\n  let staticServices = getGlobalStorageValue<{ [id: string]: IService }>(GLOBAL_STATIC_SERVICES);\n  if (!staticServices[CODE_LOADER_MODULE_NAME]) {\n    staticServices[CODE_LOADER_MODULE_NAME] = new InitialComponentLoader();\n  }\n  for (const key in staticServices) {\n    world.getFirstComponentByType<Services>(Services.name).setService(key, staticServices[key]);\n  }\n\n  (staticServices[CODE_LOADER_MODULE_NAME] as InitialComponentLoader).startLoading(world, initialScene, loadedCallBack, moduleStorage).then(() => {\n    finished(world);\n  });\n  return world;\n}\n\nexport async function createWorld(\n  initialScene: WorldDefinition = {\n    version: \"2.0\",\n    entities: [],\n  },\n  loadedCallBack: (progress: number, total: number) => void = () => {},\n  moduleStorage?: LocalModules,\n  world?: WorldEntity\n) {\n  return new Promise<WorldEntity>((resolve) => {\n    createWorldSync(initialScene, loadedCallBack, resolve, moduleStorage, world);\n  });\n}\n","import { WorldEntity } from \"@root/lib/modules/core/ecs/WorldEntity\";\nimport { createWorld } from \"@root/lib/modules/core/loader/BasicInit\";\nimport { WorldDefinition, WorldDefinitionV2 } from \"@root/lib/modules/core/loader/WorldDefinition\";\n\nexport const BUILD_VERSION = require(\"../../../../../package.json\").version;\nconsole.log(\"Axolotis-player version :\" + BUILD_VERSION);\n\nconst windowReady = (callBack: () => void) => {\n  if (document.readyState === \"complete\" && document.body) {\n    callBack();\n  } else {\n    window.addEventListener(\"DOMContentLoaded\", callBack);\n  }\n};\n\nexport async function initHtmlFromUrl(\n  url: string,\n  config: {\n    onProgress?: (progress: number, total: number) => void;\n    onLoaded?: () => void;\n  } = {}\n): Promise<WorldEntity> {\n  if (!config.onProgress) {\n    config.onProgress = (progress: number, total: number) => {\n      console.log(\"[\" + url + \"] : [\" + progress + \"/\" + total + \"]\");\n    };\n  }\n  if (!config.onLoaded) {\n    config.onLoaded = () => {\n      console.log(\"[\" + url + \"] : loading complete\");\n    };\n  }\n  const r = await fetch(url);\n  const html = await r.text();\n  const parser = new DOMParser();\n  const document = parser.parseFromString(html, \"text/html\");\n  let scene: HTMLCollection = document.body.getElementsByTagName(\"ax-scene\"); //TODO assume only one scene\n  if (!scene || (scene && scene.length == 0)) {\n    console.warn(\"Axolotis scene not found (no tag ax-scene)\");\n    config.onLoaded();\n    return;\n  }\n  console.log(scene);\n  const world = await createWorld(htmlToJson(scene), config.onProgress);\n  config.onLoaded();\n  return world;\n}\n\nexport function initHtml(\n  config: {\n    onProgress?: (progress: number, total: number) => void;\n    onLoaded?: (world: WorldEntity) => void;\n  } = {}\n) {\n  if (!config.onProgress) {\n    config.onProgress = (progress: number, total: number) => {\n      console.log(\"[\" + progress + \"/\" + total + \"]\");\n    };\n  }\n  if (!config.onLoaded) {\n    config.onLoaded = (world: WorldEntity) => {\n      console.log(\"loading complete\");\n    };\n  }\n  windowReady(() => {\n    let scene: HTMLCollection = window.document.body.getElementsByTagName(\"ax-scene\"); //TODO assume only one scene\n    if (!scene || (scene && scene.length == 0)) {\n      console.warn(\"Axolotis scene not found (no tag ax-scene)\");\n      createWorld().then(config.onLoaded);\n      return;\n    }\n    console.log(scene);\n    createWorld(htmlToJson(scene), config.onProgress).then(config.onLoaded);\n  });\n}\n\nfunction htmlToJson(scene: HTMLCollection): WorldDefinition {\n  let sceneEl = scene[0];\n  const ret: WorldDefinitionV2 = {\n    version: \"2.0\",\n    entities: [],\n  };\n  // @ts-ignore\n  for (const entity of sceneEl.getElementsByTagName(\"ax-entity\")) {\n    let entityRet = { components: [] };\n\n    for (const componentEl of entity.getElementsByTagName(\"ax-component\")) {\n      let correctJson = JSON.stringify({});\n      if (componentEl.getAttribute(\"config\")) {\n        //convert relaxed json to proper json\n        correctJson = componentEl.getAttribute(\"config\").replace(/(['\"])?([a-z0-9A-Z_]+)(['\"])?:/g, '\"$2\": ');\n      }\n      let component = {\n        module: componentEl.getAttribute(\"module\"),\n        config: JSON.parse(correctJson),\n      };\n      entityRet.components.push(component);\n    }\n    ret.entities.push(entityRet);\n  }\n  return ret;\n}\n","import { getGlobalStorageValue, GLOBAL_WORLDS_ENTITY, IService, Services, WorldEntity } from \"@root/lib\";\n\nexport function getGlobalWorld() {\n  let worlds = getGlobalStorageValue<WorldEntity[]>(GLOBAL_WORLDS_ENTITY, false);\n  if (worlds && worlds.length > 0) {\n    return worlds[0];\n  } else {\n    throw new Error(\"No Axolotis world initialized\");\n  }\n}\n\nexport function getServiceSync<T extends IService>(serviceName: string, world: WorldEntity = null): T {\n  if (!world) {\n    world = getGlobalWorld();\n  }\n  return world.getFirstComponentByType<Services>(Services.name).getServiceSync<T>(serviceName);\n}\n\nexport async function getService<T extends IService>(serviceName: string, world: WorldEntity = null): Promise<T> {\n  if (!world) {\n    world = getGlobalWorld();\n  }\n  return world.getFirstComponentByType<Services>(Services.name).getService<T>(serviceName);\n}\n","import Entity from \"@root/lib/modules/core/ecs/Entity\";\nimport { instantiateAsyncModule } from \"@root/lib/modules/core/loader/JsLoader\";\nimport Component from \"@root/lib/modules/core/ecs/Component\";\nimport { ComponentFactory } from \"@root/lib/modules/core/ecs/ComponentFactory\";\nimport { CODE_LOADER_MODULE_NAME, InitialComponentLoader, Services, WorldEntity } from \"@root/lib\";\n\nexport class LazyEntity extends Entity {\n  constructor(private world: WorldEntity) {\n    super();\n  }\n\n  async addComponentAsync<T extends Component>(moduleName: string, config: any = {}): Promise<T> {\n    let services = this.world.getFirstComponentByType<Services>(Services.name);\n    let codeLoader = await services.getService<InitialComponentLoader>(CODE_LOADER_MODULE_NAME);\n    let modulePromise = instantiateAsyncModule<T>(moduleName, codeLoader.getModuleStorage(), this.world, config || {});\n\n    let module: any = await await modulePromise;\n    let component = module.getType ? module : ((await module.createComponent(this.world, config || {})) as Component);\n    return component as T;\n  }\n\n  public getType(): string {\n    return LazyEntity.name;\n  }\n}\n","import {\n  getGlobalStorageValue,\n  GLOBAL_STATIC_SERVICES,\n  GLOBAL_WORLDS_ENTITY,\n  IService,\n  Module,\n  registerLocalModule,\n  Services,\n  setGlobalStorageValue,\n  WorldEntity,\n} from \"@root/lib\";\n\n/**\n * An Item (or SmartItem) is a set of Module (Services and/or Component)\n */\nexport interface Item {\n  /**\n   * Register a set of static services\n   */\n  staticService(): { [id: string]: IService };\n\n  /**\n   * Register Asynchronous/Dynamic Component or Service\n   */\n  modules(): { [id: string]: Module };\n}\n\nexport function registerItem(item: Item) {\n  let worlds = getGlobalStorageValue<WorldEntity[]>(GLOBAL_WORLDS_ENTITY, false);\n  let services = item.staticService(); //instanciates all the services\n\n  let staticServices = getGlobalStorageValue<{ [id: string]: IService }>(GLOBAL_STATIC_SERVICES);\n  for (const key in services) {\n    if (staticServices[key]) {\n      throw new Error(\"service already exist\");\n    }\n    staticServices[key] = services[key];\n  }\n  setGlobalStorageValue(GLOBAL_STATIC_SERVICES, { ...services, ...getGlobalStorageValue<{ [id: string]: IService }>(GLOBAL_STATIC_SERVICES) });\n  if (worlds) {\n    for (const world of worlds) {\n      if (!world) {\n        throw new Error(\"undefined world\");\n      }\n      for (const key in services) {\n        world.getFirstComponentByType<Services>(Services.name).setService(key, services[key]);\n      }\n    }\n  }\n\n  let modules = item.modules();\n  for (const key in modules) {\n    registerLocalModule(key, modules[key]);\n  }\n}\n"],"names":["webpackUniversalModuleDefinition","root","factory","exports","module","define","amd","this","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","Entity","constructor","addComponent","component","init","components","push","removeAllComponents","forEach","comp","removeComponent","destroy","filter","addComponents","getComponents","getComponentByType","type","ret","getType","getComponentByTypeStartsWith","startsWith","getFirstComponentByTypeStartsWith","getFirstComponentByType","name","WorldEntity","super","axolotis","GLOBAL_WORLDS_ENTITY","GLOBAL_STATIC_SERVICES","GLOBAL_LOCAL_MODULE","getGlobalStorage","window","setGlobalStorageValue","getGlobalStorageValue","auto","globalStorage","registerLocalModule","moduleStorage","Error","registerLocalModuleList","localModulesList","verbose","console","log","assign","async","instantiateLocalAsyncModule","fqcn","localModules","world","config","localModule","sub","classname","DependencyComponentList","dependencies","i","length","dep","services","Services","service","getService","instantiateAsyncModule","moduleName","CODE_LOADER_MODULE_NAME","InitialComponentLoader","initialLoading","Promise","resolve","initialLoadingResolver","getModuleStorage","scene","loadedCallBack","version","promises","entity","entities","componentDef","reject","createComponent","promise","load","modules","nbLoaded","promiseCb","then","all","catch","reason","error","LazyServices","getWorld","setService","serviceAsync","modulesList","modulePromise","createService","getServiceSync","createWorldSync","initialScene","finished","serviceEntity","staticServices","startLoading","createWorld","BUILD_VERSION","require","windowReady","callBack","document","readyState","body","addEventListener","initHtmlFromUrl","url","onProgress","progress","total","onLoaded","fetch","html","text","parser","DOMParser","parseFromString","getElementsByTagName","warn","htmlToJson","initHtml","sceneEl","entityRet","componentEl","correctJson","JSON","stringify","getAttribute","replace","parse","getGlobalWorld","worlds","serviceName","LazyEntity","registerItem","item","staticService"],"sourceRoot":""}