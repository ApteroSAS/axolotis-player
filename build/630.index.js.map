{"version":3,"file":"630.index.js","mappings":";;;;;;;;;;;0TASO,MAAMA,EACC,aAACC,GACX,IAAIC,QAAmBD,EAASE,WAC9B,mDAEEC,EAAS,IAAIC,EAIjB,OAHAH,EAAWI,sBAAsBC,MAAK,KACpCH,EAAOI,6BAEFJ,GAIJ,MAAMC,EAcXI,cAAc,eAJqC,IAIrC,kBAHa,GAGb,0BAF4B,SAE5B,wBAD0B,SAGxCD,0BACE,MAAME,EAAWC,IACfC,KAAKC,gBAAgBR,EAAUS,MAC/B,MAAMC,EAAQJ,EAAIC,KAAKI,SACvBJ,KAAKI,SAAWL,EAChBM,sBAAsBP,GACtB,IAAK,MAAMQ,KAAYN,KAAKO,MAC1BP,KAAKC,gBAAgBK,GACrBN,KAAKO,MAAMD,GAAUH,GACrBH,KAAKQ,cAAcF,GAErBN,KAAKQ,cAAcf,EAAUS,OAE/BG,sBAAsBP,GAGxBW,sBAAsBC,EAAuBC,GAC3CX,KAAKC,gBAAkBS,EACvBV,KAAKQ,cAAgBG,EAGvBC,WAAWC,UACFb,KAAKO,MAAMM,GAClBb,KAAKC,gBAAgBY,GACrBb,KAAKQ,cAAcK,GAGrBC,QAAQD,EAAkBE,GACxB,GAAIf,KAAKO,MAAMM,GACb,MAAM,IAAIG,MAEZhB,KAAKO,MAAMM,GAAYE,EAGzBE,UACE,OAAOxB,EAAUS","sources":["webpack://axolotis-player/./src/lib/modules/FrameLoop.ts"],"sourcesContent":["import Component from \"@root/lib/modules/core/ecs/Component\";\n\nimport { CodeLoaderComponent } from \"@root/lib/modules/core/loader/CodeLoaderComponent\";\nimport {\n  LazyServices,\n  Service,\n} from \"@root/lib/modules/core/service/LazyServices\";\nimport { WebpackLazyModule } from \"@root/lib/modules/core/loader/WebpackLoader\";\n\nexport class Factory implements WebpackLazyModule, Service<FrameLoop> {\n  async create(services: LazyServices): Promise<FrameLoop> {\n    let codeLoader = await services.getService<CodeLoaderComponent>(\n      \"@root/lib/modules/core/loader/CodeLoaderService\"\n    );\n    let module = new FrameLoop();\n    codeLoader.awaitInitialLoading().then(() => {\n      module.startAnimationFrameLoop();\n    });\n    return module;\n  }\n}\n\nexport class FrameLoop implements Component {\n  //TODO frame loop\n  // setInterval Frameloop\n  // animationFrame\n  // Physic update\n  // low workload adaptative loop? Like when FPS is green we execute code once evry Frame when it is not we execute once every seconde.\n  // worker loop?\n  // stats for all those loop (stats.js)\n  // API to add task consumer?\n  //callbacks:((delta:number)=>void)[] = [];\n  loops: { [id: string]: (delta: number) => void } = {};\n  private prevTime: number = 0;\n  private monitoringStart: (name) => void = () => {};\n  private monitoringEnd: (name) => void = () => {};\n  constructor() {}\n\n  startAnimationFrameLoop() {\n    const animate = (t) => {\n      this.monitoringStart(FrameLoop.name);\n      const delta = t - this.prevTime;\n      this.prevTime = t;\n      requestAnimationFrame(animate);\n      for (const callback in this.loops) {\n        this.monitoringStart(callback);\n        this.loops[callback](delta);\n        this.monitoringEnd(callback);\n      }\n      this.monitoringEnd(FrameLoop.name);\n    };\n    requestAnimationFrame(animate);\n  }\n\n  setMonitoringCallback(start: (name) => void, end: (name) => void) {\n    this.monitoringStart = start;\n    this.monitoringEnd = end;\n  }\n\n  removeLoop(loopName: string) {\n    delete this.loops[loopName];\n    this.monitoringStart(loopName); //set this loop to 0 fix\n    this.monitoringEnd(loopName);\n  }\n\n  addLoop(loopName: string, iterationCallback: (delta: number) => void) {\n    if (this.loops[loopName]) {\n      throw new Error();\n    }\n    this.loops[loopName] = iterationCallback;\n  }\n\n  getType(): string {\n    return FrameLoop.name;\n  }\n}\n"],"names":["Factory","services","codeLoader","getService","module","FrameLoop","awaitInitialLoading","then","startAnimationFrameLoop","constructor","animate","t","this","monitoringStart","name","delta","prevTime","requestAnimationFrame","callback","loops","monitoringEnd","setMonitoringCallback","start","end","removeLoop","loopName","addLoop","iterationCallback","Error","getType"],"sourceRoot":""}